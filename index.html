<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rewards Airdrop Mining</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
body { font-family: Arial, sans-serif; background:#0a0a0a; color:#e0e0e0; margin:0; text-align:center; }
#login-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.85); display:flex; align-items:center; justify-content:center; z-index:9999; }
#login-box { background:#111; padding:25px; border-radius:12px; width:320px; max-width:90%; text-align:center; overflow:visible; box-shadow: 0 0 20px #00ff99aa; }
#login-box h2 { color:white; margin-bottom:15px; }
#login-box input { width:90%; padding:8px; margin:5px 0; border-radius:6px; border:none; }
button { padding:10px 20px; margin:5px; border:none; border-radius:8px; cursor:pointer; background:#00ff99; color:#000; font-weight:bold; transition: transform 0.1s; }
button:hover { transform: scale(1.05); }
#app { display:none; padding:20px; }
.energy-bar { width:100%; background:#333; border-radius:12px; overflow:hidden; margin:10px 0; }
.energy-fill { height:20px; background:lime; width:100%; transition:width 0.3s; animation:flash 2s infinite; }
@keyframes flash { 0%{opacity:1} 50%{opacity:0.6} 100%{opacity:1} }
#stats { margin:20px; text-align:left; display:inline-block; }
a { color:yellow; text-decoration:none; } a:hover { text-decoration:underline; }
#coming-soon { margin-top:20px; padding:15px; background:#222; border-radius:12px; color:#ffcc00; }

/* Section options retractable */
#settings { margin-top:20px; text-align:left; width:90%; max-width:500px; margin-left:auto; margin-right:auto; }
#settings button { width:100%; background:#222; color:yellow; text-align:left; }
#settings-content { display:none; background:#111; padding:10px; border-radius:8px; margin-top:5px; }
.setting-item { margin:5px 0; }
</style>
</head>
<body>

<!-- LOGIN / INSCRIPTION -->
<div id="login-overlay">
  <div id="login-box">
    <h2>Connexion par num√©ro</h2>
    <input type="tel" id="phone" placeholder="Num√©ro de t√©l√©phone"><br><br>
    <button id="btnSignIn">Se connecter</button>
  </div>
</div>

<!-- APP -->
<div id="app">
  <h1>Rewards Airdrop Mining</h1>
  <div id="stats">
    <p><b>Deadspot:</b> <span id="deadspot">0</span></p>
    <p><b>XP:</b> <span id="xp">0</span></p>
    <p><b>Level:</b> <span id="level">1</span></p>
    <p><b>√ânergie:</b> <span id="energy">1000</span> / <span id="energyMax">1000</span></p>
    <p><b>Bonus accumul√©:</b> <span id="bonus">0</span></p>
    <p><b>VIP Progress:</b> <span id="vip">0%</span></p>
  </div>
  <div class="energy-bar"><div class="energy-fill" id="energy-fill"></div></div>
  <button id="clickBtn">CLICK to Earn</button>
  
  <!-- Coming Soon / Bonus / VIP -->
  <div id="coming-soon">
    <h3>üéâ Coming Soon !!</h3>
    <p>Bonus accumul√© et <b>VIP Status Approved!</b></p>
  </div>

  <br><br>
  <a href="cpu_simulator.html">Aller √† la page Simulateur CPU</a>

  <!-- Options / Settings retractable -->
  <div id="settings">
    <button id="toggleSettings">‚öôÔ∏è Options / Management</button>
    <div id="settings-content">
      <div class="setting-item">
        <label>Activer double authentification: </label>
        <input type="checkbox" id="enable2FA">
      </div>
      <div class="setting-item">
        <label>R√©glage Energie max: </label>
        <input type="number" id="maxEnergyInput" value="1000">
        <button onclick="setMaxEnergy()">Valider</button>
      </div>
      <div class="setting-item">
        <label>Multiplier Deadspot: </label>
        <input type="number" id="deadspotMultiplier" value="1" step="0.1">
        <button onclick="setDeadspotMultiplier()">Valider</button>
      </div>
      <div class="setting-item">
        <label>Autres r√©glages futurs‚Ä¶</label>
      </div>
    </div>
  </div>
</div>

<script>
// ============================
// CONFIG SUPABASE
// ============================
const SUPABASE_URL = "https://wbavwtwslofcrpeuyqak.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_Q_Jm1qse1MuBwINNgm7QuQ_sqQG-WfA";
const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

// STATE INITIAL
let state = { deadspot:0, xp:0, level:1, energy:1000, energyMax:1000, bonus:0, vip:0 };
let deadspotMultiplier = 1;

// ============================
// LOAD / SAVE via BACK-END
// ============================
async function loadUserState() {
  const { data: { session } } = await supabaseClient.auth.getSession();
  if(!session) return;
  const userId = session.user.id;
  const res = await fetch('http://localhost:3000/api/loadUserState', {
    method: 'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ userId })
  });
  const result = await res.json();
  if(result.state) state = result.state;
  updateUI();
}

async function saveUserState() {
  const { data: { session } } = await supabaseClient.auth.getSession();
  if(!session) return;
  const userId = session.user.id;
  await fetch('http://localhost:3000/api/saveUserState', {
    method: 'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ userId, state })
  });
}

// ============================
// UPDATE UI
// ============================
function updateUI(){
  document.getElementById("deadspot").innerText = (state.deadspot*deadspotMultiplier).toFixed(4);
  document.getElementById("xp").innerText = state.xp.toFixed(2);
  document.getElementById("level").innerText = state.level;
  document.getElementById("energy").innerText = state.energy;
  document.getElementById("energyMax").innerText = state.energyMax;
  document.getElementById("bonus").innerText = state.bonus.toFixed(2);
  document.getElementById("vip").innerText = state.vip.toFixed(1) + "%";
  document.getElementById("energy-fill").style.width = (state.energy/state.energyMax*100)+"%";
  document.getElementById("clickBtn").disabled = state.energy <= 0;
}

// ============================
// LOGIN PAR T√âL√âPHONE
// ============================
document.getElementById("btnSignIn").onclick = async () => {
  const phone = document.getElementById("phone").value;
  if(!phone) return alert("Veuillez entrer votre num√©ro de t√©l√©phone");

  // Ici on peut utiliser Supabase OTP login ou juste simuler login local dev
  // Exemple: on consid√®re phone valide pour dev
  document.getElementById("login-overlay").style.display="none";
  document.getElementById("app").style.display="block";
  await loadUserState();
}

// ============================
// CLICK TO EARN
// ============================
document.getElementById("clickBtn").onclick = () => {
  if(state.energy <=0) return alert("Pas assez d'√©nergie");
  state.energy--;

  const gainDeadspot = (Math.random() * (0.278 - 0.0001) + 0.0001);
  state.deadspot += gainDeadspot;

  state.xp += Math.floor(Math.random() * (1875 - 35 + 1) + 35);
  state.bonus += gainDeadspot * 0.05;
  state.vip = Math.min(100, state.xp / 10000 * 100);

  while(state.xp > (15*Math.pow(1.27,state.level-1))) state.level++;

  updateUI();
  saveUserState();
}

// ============================
// AUTO ENERGY RECHARGE & VIP BOOST
// ============================
setInterval(() => {
  if(state.energy < state.energyMax) {
    state.energy = Math.min(state.energy + 5, state.energyMax);
  }
  state.vip = Math.min(100, state.vip + 0.05);
  updateUI();
  saveUserState();
}, 5000);

// ============================
// SETTINGS / MANAGEMENT
// ============================
document.getElementById("toggleSettings").onclick = () => {
  const content = document.getElementById("settings-content");
  content.style.display = content.style.display === "none" ? "block" : "none";
}

function setMaxEnergy() {
  const val = parseInt(document.getElementById("maxEnergyInput").value);
  if(val>0) state.energyMax = val;
  updateUI();
}

function setDeadspotMultiplier() {
  const val = parseFloat(document.getElementById("deadspotMultiplier").value);
  if(val>0) deadspotMultiplier = val;
  updateUI();
}
</script>
</body>
</html>
